<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RAC Weekend Flash | 深度 AI 洞察版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'neo-bg': '#f3f4f6', 'neo-main': '#FF4D4D', 'neo-yellow': '#FFDE59' },
                    boxShadow: { 'neo': '8px 8px 0px 0px rgba(0,0,0,1)', 'neo-sm': '4px 4px 0px 0px rgba(0,0,0,1)' }
                }
            }
        }
    </script>
    <style>
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .loading-skeleton {
            background: linear-gradient(90deg, #efefef 25%, #fde047 50%, #efefef 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        /* 隐藏导出容器，但保持其在 DOM 中以便抓取 */
        #poster-export-area { position: absolute; left: -9999px; top: 0; }
    </style>
</head>
<body class="bg-neo-bg text-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const DEEPSEEK_API_KEY = "sk-b22bf27433b54cc5ab320a7c91d0cf36";

        // --- DeepSeek API 调用 ---
        async function fetchAIAnalysis(newsItem) {
            try {
                const response = await fetch("https://api.deepseek.com/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {
                                role: "system",
                                content: "你是一位RAC Studio的资深艺术留学专家。语气犀利、专业、毒舌但有洞见。请针对用户提供的资讯标题，生成一段150字以内的点评。要求：1. 揭示行业真相；2. 给正在准备作品集的学生一个具体的避雷或建议。开头固定为【RAC专家犀利点评】。"
                            },
                            {
                                role: "user",
                                content: `资讯标题：${newsItem.titleCN}\n英文背景：${newsItem.title}`
                            }
                        ],
                        temperature: 0.8
                    })
                });
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error("API Error:", error);
                return "【RAC专家点评】网络波动，专家正在赶来的路上。但就此资讯而言，作品集的深度逻辑永远比表面炫技更重要。";
            }
        }

        // --- 专门用于导出高清图的组件 ---
        const ExportPoster = ({ item, aiText, posterRef }) => {
            if (!item) return null;
            return (
                <div id="poster-export-area">
                    <div ref={posterRef} className="bg-white p-12 w-[750px] border-[8px] border-black flex flex-col">
                        <div className="flex justify-between items-end border-b-[8px] border-black pb-6 mb-8">
                            <div>
                                <h1 className="text-7xl font-black italic uppercase leading-none">Flash</h1>
                                <p className="text-2xl font-bold mt-2 tracking-[0.2em]">RAC STUDIO | WEEKEND NEWS</p>
                            </div>
                            <div className="text-right">
                                <p className="text-xl font-mono font-bold uppercase">{new Date().toLocaleDateString()}</p>
                            </div>
                        </div>

                        <img src={item.image} crossOrigin="anonymous" className="w-full h-[450px] object-cover border-[6px] border-black shadow-neo mb-10" />
                        
                        <h2 className="text-5xl font-black leading-tight mb-8">
                            <span className="bg-black text-white px-4 py-1">{item.titleCN}</span>
                        </h2>

                        <div className="bg-neo-yellow border-[6px] border-black p-8 shadow-neo mb-10">
                            <div className="text-[28px] leading-[1.6] font-bold text-black whitespace-pre-wrap">
                                {aiText || "正在生成深度点评..."}
                            </div>
                        </div>

                        <div className="mt-auto flex justify-between items-center pt-6 border-t-4 border-black">
                            <p className="text-lg font-bold italic">Generated by RAC AI Intelligence</p>
                            <p className="text-sm font-mono">ID: #{item.id.toString().padStart(3, '0')}</p>
                        </div>
                    </div>
                </div>
            );
        };

        function App() {
            const [news, setNews] = useState([]);
            const [selectedItem, setSelectedItem] = useState(null);
            const [aiAnalysis, setAiAnalysis] = useState("");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const posterRef = useRef(null);

            useEffect(() => {
                // 初始化模拟数据
                const mock = [
                    { id: 1, titleCN: "欧盟AI法案正式通过，创意产业面临洗牌", title: "EU AI Act passed, impact on creative industry", image: "https://picsum.photos/seed/123/800/500" },
                    { id: 2, titleCN: "UCL巴特莱特建筑学院发布2026招生新标准", title: "UCL Bartlett 2026 Admission Guide", image: "https://picsum.photos/seed/456/800/500" },
                    { id: 3, titleCN: "Apple Vision Pro 开启空间计算设计元年", title: "Vision Pro and Spatial Computing Design", image: "https://picsum.photos/seed/789/800/500" }
                ];
                setNews(mock);
            }, []);

            // 处理选择资讯并触发 AI 调用
            const handleSelectItem = async (item) => {
                setSelectedItem(item);
                setAiAnalysis("");
                setIsAiLoading(true);
                const result = await fetchAIAnalysis(item);
                setAiAnalysis(result);
                setIsAiLoading(false);
            };

            // 高清导出
            const handleExport = async () => {
                if (!posterRef.current) return;
                const canvas = await html2canvas(posterRef.current, {
                    scale: 3, // 3倍高清
                    useCORS: true,
                    allowTaint: false,
                    backgroundColor: "#ffffff"
                });
                const link = document.createElement('a');
                link.download = `RAC-AI-Insight-${selectedItem.id}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            };

            return (
                <div className="max-w-md mx-auto min-h-screen p-4 pb-20">
                    <header className="py-8">
                        <h1 className="text-5xl font-black italic border-b-8 border-black pb-2">RAC FLASH</h1>
                        <p className="font-bold mt-2 uppercase tracking-widest text-sm">DeepSeek AI Real-time Insight</p>
                    </header>

                    <div className="space-y-6">
                        {news.map(item => (
                            <div key={item.id} onClick={() => handleSelectItem(item)} className="bg-white border-4 border-black shadow-neo overflow-hidden cursor-pointer active:translate-x-1 transition-all">
                                <img src={item.image} className="h-40 w-full object-cover border-b-4 border-black grayscale hover:grayscale-0 transition-all" />
                                <div className="p-4 flex justify-between items-center">
                                    <h3 className="text-xl font-black leading-tight pr-4">{item.titleCN}</h3>
                                    <div className="bg-black text-white p-2">→</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* 详情及 AI 点评弹窗 */}
                    {selectedItem && (
                        <div className="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4">
                            <div className="bg-white w-full max-w-lg border-t-4 sm:border-4 border-black h-[85vh] sm:h-auto overflow-y-auto flex flex-col">
                                <div className="p-4 border-b-4 border-black flex justify-between items-center sticky top-0 bg-white z-10">
                                    <span className="font-black italic">RAC EXPERT INSIGHT</span>
                                    <button onClick={() => setSelectedItem(null)} className="text-2xl font-black">✕</button>
                                </div>
                                
                                <div className="p-6">
                                    <h2 className="text-3xl font-black mb-6">{selectedItem.titleCN}</h2>
                                    
                                    <div className={`border-4 border-black p-5 shadow-neo-sm min-h-[150px] relative ${isAiLoading ? 'loading-skeleton' : 'bg-neo-yellow'}`}>
                                        {isAiLoading ? (
                                            <p className="font-bold italic">正在连线 RAC 资深专家进行深度毒舌解析...</p>
                                        ) : (
                                            <p className="text-lg font-bold leading-relaxed whitespace-pre-wrap">{aiAnalysis}</p>
                                        )}
                                    </div>

                                    <div className="mt-8 space-y-4">
                                        <button 
                                            onClick={handleExport}
                                            disabled={isAiLoading}
                                            className="w-full bg-black text-white font-black py-4 text-xl shadow-neo active:shadow-none active:translate-x-1 active:translate-y-1 transition-all disabled:opacity-50"
                                        >
                                            {isAiLoading ? "AI 思考中..." : "导出高清点评海报"}
                                        </button>
                                        <p className="text-center text-xs font-bold text-gray-500 uppercase tracking-widest">Powered by DeepSeek-V3 Architecture</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 隐藏的海报生成区 */}
                    <ExportPoster item={selectedItem} aiText={aiAnalysis} posterRef={posterRef} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
